# 多态

多态代码指的是一套可以用不同的类型反复使用的代码，这种灵活性产生松耦合且高度可重用的代码。

有助于消除繁琐的复制粘贴工作，更易于维护，扩展。

C++中有两种多态：**编译时多态**、**运行时多态**。

# 接口

接口是不包含数据和代码的共享边界。其中定义**接口所有实现**都支持的函数签名。接口的实现就是支持接口的代码和数据。

更具体地说：接口是实现接口的类和该类的消费者之间的**契约**。

接口的使用可以促进**高度可重用和松耦合**的代码的产生。

## 对象组合和实现继承

对象组合是一种**设计模式**，具体是指：类中包含其他类类型的成员。

另外的一种可以实现运行时多态的**过时的**设计模式叫做**实现继承**。实现继承具体是指：建立类的层次结构，每个子类都从其父类继承功能。

## 基类继承

**基类继承**构成了类层级结构，这样做的好处是，可以把派生类引用**当作基类引用类型**来使用。允许基类引用指向派生类引用，反之不行！

**派生**的主要原因是想要**继承基类的成员**，实现复用。

派生类从基类中继承**非私有成员**。类可以像使用普通成员一样使用继承的成员。

## 虚方法

使用`virtual`关键字可以让派生类覆盖基类的方法。

通过在方法的定义中添加`virtual`，我们声明如果存在派生类的实现，就应该使用它。

在派生类中将`override`关键字添加到虚方法实现的声明中。

如果**想要求**派生类来实现该方法，则可以在方法定义中添加`=0`后缀。

将**同时使用**`virtual`关键字和`=0`后缀的方法称为**纯虚方法**。

含有**纯虚方法**的类**不能被实例化**！并且这样的类派生出的子类**必须实现**这些**纯虚方法**。

>虚函数可能会产生运行时开销，尽管开销通常很低（在普通函数调用的25%以内）。编译器会生成包含函数指针的虚函数表(vtable)。在运行时，接口的消费者一般不知道它的底层类型，但它知道如何调用接口的方法（多亏了vtable）。在某些情况下，链接器可以检测到接口的所有用法，并将函数调用去虚化。这就从vtable中删除了函数调用，从而消除了相关的运行时开销。

## 纯虚类和虚析构函数

通过从**只包含纯虚方法**的基类派生来实现接口继承。这种类被称为**纯虚类**。C++中的接口就是纯虚类。

在声明接口时，声明虚析构函数是**可选的**，但通常需要在接口中添加虚析构函数，因为在某些罕见的情况下，如果没有把析构函数标记为虚函数，就有可能在不知情的情况下造成**资源泄漏**。

## 使用接口

设置类成员的方法有两种：

❑ **构造函数注入**：对于构造函数注入，通常需要使用**接口引用**。因为引用不能被重定位，所以在对象的生命周期内不会改变。

❑ **属性注入**：对于属性注入，可以使用方法来设置**指针成员**。这允许改变该成员指向的对象。

通常情况下，当注入的字段在对象的整个**生命周期内不会改变**时，可以使用构造函数注入。如果需要**灵活地修改字段**，则应提供方法来执行属性注入。
